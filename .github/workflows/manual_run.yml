name: Manual Code Run

on:
  workflow_dispatch:
    # 이 워크플로우는 GitHub Actions 탭에서 'Run workflow' 버튼을 통해 수동으로 실행할 수 있습니다.
    # 입력 파라미터를 추가하여 실행 시점에 값을 받을 수도 있습니다.

jobs:
  run_script:
    runs-on: ubuntu-latest

    env:
      GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
      TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
      TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
      TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}

    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_PAT }}

      - name: Set up Python environment
        uses: actions/setup-python@v5
        with:
          python-version: "3.9"

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Execute the main code
        run: |
          echo "Starting manual script run with environment variables..."
          python main.py
          echo "Script execution finished."

      - name: Commit processed posts file
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add processed_posts.txt
          git commit -m "feat: Add processed post [skip ci]"
          git push
